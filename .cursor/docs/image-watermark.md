# 图片加水印工具实现规范文档

## 1. 需求拆分归档

### 1.1 上传与文件限制
- **批量支持**: 支持同时选择多张图片，最大限制为 **5张**。
- **类型校验**: 仅允许上传图片类型文件 (`image/*`)。
- **交互方式**: 支持点击上传及拖拽上传。

### 1.2 水印配置 (实时预览)
- **内容控制**:
  - 水印文本: 用户自定义输入。
- **布局控制**:
  - 密度 (间距): 支持调整水平和垂直间距。
  - 角度: 支持调整水印旋转角度 (0° - 360°)。
- **样式控制**:
  - 字体选择: 常用正式官方字体 (如：微软雅黑、宋体、黑体、Arial、Times New Roman)。
  - 字体粗细: 支持常规 (Normal) 与 加粗 (Bold)。
  - 字体大小: 支持滑块调节。
  - 颜色选择: 支持 Hex 颜色选择及透明度 (Alpha) 调节。

### 1.3 预览与导出
- **实时预览**: 
  - 预览区域自动等比例缩放图片以适应屏幕。
  - 任何配置修改立即反映在预览画布上。
- **导出设置**:
  - 导出格式: 支持 Canvas 原生格式 (`image/png`, `image/jpeg`, `image/webp`)。
  - 导出质量: 针对 JPEG/WebP 提供 0-1 的质量调节。
  - 导出分辨率: 导出时必须保持原图分辨率，不受预览缩放影响。

---

## 2. 方案设计 (待确认)

### 2.1 技术选型
- **核心库**: Vue 3 (TSX) + Ant Design Vue。
- **渲染引擎**: 原生 HTML5 Canvas。
- **逻辑封装**: 使用 `useWatermark` Hook 封装 Canvas 绘制逻辑。

### 2.2 UI 结构设计
采用 **“左侧预览工作区 + 右侧配置面板”** 的布局，顶部设有操作栏：
- **顶部操作栏 (Header)**:
  - 右侧设有 `导出按钮`。
  - 点击导出按钮弹出 `ExportModal`:
    - **配置摘要 (只读, 每行展示一项)**:
      - 水印文本: [内容]
      - 字体样式: [字体名] / [粗细]
      - 布局信息: [间距] / [角度]
    - **导出设置 (可配置)**:
      - 导出格式选择 (`image/png`, `image/jpeg`, `image/webp`)。
      - 导出质量调节滑块 (针对 JPG/WEBP)。
      - 分辨率调整: 默认原图分辨率，支持自定义宽高（保持比例）。
    - `确认下载` 按钮。
- **左侧工作区 (Content)**:
  - `PreviewCanvas`: 居中展示当前选中图片的预览效果。
  - `Pagination`: 多图上传后的切换控件。
- **右侧面板 (Sider)**:
  - `UploadSection`: 批量上传组件，展示已上传列表（最多5张）。
  - `ConfigSection`: 
    - 水印文本输入。
    - 布局调节：间距、旋转角度。
    - 样式调节：字体、大小、粗细、颜色/透明度。

### 2.3 核心逻辑实现思路
1. **数据管理**: 使用 `ref` 存储当前选中的图片对象、配置参数对象。
2. **渲染流程**:
   - 创建离屏 Canvas 用于生成单个水印贴图。
   - 主 Canvas 绘制原图。
   - 使用 `CanvasRenderingContext2D.createPattern` 将水印贴图平铺在主 Canvas 上。
   - 预览时，通过 CSS `max-width: 100%` 控制显示；导出时，重新创建一个与原图等大的 Canvas 进行绘制并调用 `toDataURL`。

---

## 3. 实现计划 (待确认)
1. **阶段一**: 基础框架搭建，实现多图上传与基础 UI 布局。
2. **阶段二**: 实现 Canvas 核心渲染逻辑，支持基础文本水印。
3. **阶段三**: 完善样式配置（字体、颜色、透明度）与布局配置（密度、角度）。
4. **阶段四**: 实现导出功能，支持格式选择与质量调节。
5. **阶段五**: 整体优化、性能调优（如大图处理）与兼容性检查。
